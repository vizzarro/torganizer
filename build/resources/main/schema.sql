DROP TABLE IF EXISTS IMAGE;
CREATE TABLE IMAGE (
	id BIGINT PRIMARY KEY,
 	description VARCHAR(255) NOT NULL,
 	default_small blob,
 	default_normal blob,
 	url_small VARCHAR(400),
 	url_normal VARCHAR(400)
);
DROP SEQUENCE IF EXISTS IMAGE_SEQ;
CREATE SEQUENCE IMAGE_SEQ;

DROP TABLE IF EXISTS MODE_TOURNAMENT;
CREATE TABLE MODE_TOURNAMENT (
	id BIGINT PRIMARY KEY,
	code VARCHAR(255) NOT NULL,
 	name VARCHAR(255) NOT NULL,
 	description VARCHAR(255) NOT NULL,
 	image BIGINT,
 	game VARCHAR(255) NOT NULL

);
DROP SEQUENCE IF EXISTS MODE_TOURNAMENT_SEQ;
CREATE SEQUENCE MODE_TOURNAMENT_SEQ;

DROP TABLE IF EXISTS GAME_FORMULA;
CREATE TABLE GAME_FORMULA (
	id BIGINT PRIMARY KEY,
	code VARCHAR(255) NOT NULL,
 	name VARCHAR(255) NOT NULL,
 	description VARCHAR(255) NOT NULL,
 	image BIGINT NOT NULL,
 	game VARCHAR(255) NOT NULL

);
DROP SEQUENCE IF EXISTS GAME_FORMULA_SEQ;
CREATE SEQUENCE GAME_FORMULA_SEQ;

DROP TABLE IF EXISTS TOURNAMENT;
CREATE TABLE TOURNAMENT (
  id BIGINT PRIMARY KEY,
  code VARCHAR(255) NOT NULL,
  name VARCHAR(250) NOT NULL,
  tournament_type VARCHAR(250) NOT NULL,
  tournament_modality BIGINT NOT NULL,
  referee_name VARCHAR(250) NOT NULL,
  game_formula BIGINT NOT NULL,
  game VARCHAR(255) NOT NULL,
  site VARCHAR(255),
  times INT,
  boards INT,
  bonus BOOLEAN,
  date_creation DATE NOT NULL
);
ALTER TABLE TOURNAMENT ADD FOREIGN KEY ( tournament_modality) REFERENCES MODE_TOURNAMENT( id ) ;
ALTER TABLE TOURNAMENT ADD FOREIGN KEY ( game_formula) REFERENCES GAME_FORMULA( id ) ;

DROP SEQUENCE IF EXISTS TOURNAMENT_SEQ;
CREATE SEQUENCE TOURNAMENT_SEQ;

DROP TABLE IF EXISTS TOURNAMENT_PARTECIPANT;
CREATE TABLE TOURNAMENT_PARTECIPANT (
	id BIGINT PRIMARY KEY,
	nominative  VARCHAR(255) NOT NULL,
	email VARCHAR(255)
);
DROP SEQUENCE IF EXISTS TOURNAMENT_PARTECIPIANT_SEQ;
CREATE SEQUENCE TOURNAMENT_PARTECIPIANT_SEQ;

DROP TABLE IF EXISTS TEAM;
CREATE TABLE TEAM (
	id BIGINT PRIMARY KEY,
	tournament_id BIGINT NOT NULL,
 	code VARCHAR(255) NOT NULL,
 	type VARCHAR(255) NOT NULL
);
ALTER TABLE TEAM ADD FOREIGN KEY ( tournament_id) REFERENCES TOURNAMENT( id ) ;
DROP SEQUENCE IF EXISTS TEAM_SEQ;
CREATE SEQUENCE TEAM_SEQ;

DROP TABLE IF EXISTS ROUND_MATCH;
CREATE TABLE ROUND_MATCH (
	id BIGINT PRIMARY KEY,
	tournament_id BIGINT NOT NULL
);
ALTER TABLE ROUND_MATCH ADD FOREIGN KEY ( tournament_id) REFERENCES ROUND_MATCH( id ) ;
DROP SEQUENCE IF EXISTS ROUND_MATCH_SEQ;
CREATE SEQUENCE ROUND_MATCH_SEQ;

DROP TABLE IF EXISTS RMATCH;
CREATE TABLE RMATCH (
	id BIGINT PRIMARY KEY,
	round_id BIGINT NOT NULL,
 	first_team_id BIGINT NOT NULL,
 	second_team_id BIGINT NOT NULL
);
ALTER TABLE RMATCH ADD FOREIGN KEY ( round_id) REFERENCES ROUND_MATCH( id ) ;
DROP SEQUENCE IF EXISTS RMATCH_SEQ;
CREATE SEQUENCE RMATCH_SEQ;
